# Google Apps Script (GAS) セットアップガイド

このガイドでは、Google Apps Script (GAS) を使ってGoogle Sheetsと連携する方法を説明します。

## 🎯 なぜGASを使うのか？

APIキーの代わりにGASを使うことで：
- ✅ 認証の問題を回避
- ✅ より安全なアクセス
- ✅ 確実な動作

---

## 📋 セットアップ手順

### ステップ1: Google Sheetsを開く

1. 連携したいGoogle Sheetsを開く
2. メニューから「拡張機能」→「Apps Script」をクリック

### ステップ2: GASコードを貼り付け

1. 既存のコード（`function myFunction() {}`）を**すべて削除**
2. `docs/gas-script.gs` の内容を**すべてコピー**
3. Apps Scriptエディタに**貼り付け**
4. 「💾 保存」ボタンをクリック（Ctrl+S）

### ステップ3: Web Appとしてデプロイ

1. 右上の「デプロイ」→「新しいデプロイ」をクリック
2. 「種類の選択」で「⚙️ ウェブアプリ」を選択
3. 以下のように設定:
   - **説明**: `Care Dashboard API`
   - **次のユーザーとして実行**: `自分`
   - **アクセスできるユーザー**: `全員`
4. 「デプロイ」ボタンをクリック
5. **承認が必要**と表示されたら:
   - 「アクセスを承認」をクリック
   - Googleアカウントを選択
   - 「詳細」→「（プロジェクト名）に移動」をクリック
   - 「許可」をクリック
6. **Web App URL** が表示されます
   - 例: `https://script.google.com/macros/s/AKfycby.../exec`
   - このURLをコピーしてください ⚠️ 重要！

### ステップ4: ダッシュボードに設定

1. ダッシュボードの「⚙️ 設定」を開く
2. **GAS Web App URL** の欄に、コピーしたURLを貼り付け
3. 「保存」をクリック
4. 「接続テスト」をクリックして確認

---

## ✅ 動作確認

### テスト1: シート一覧の取得
1. ダッシュボードの「📊 ダッシュボード」タブを開く
2. シートのタブが表示されるか確認

### テスト2: データの読み込み
1. シートタブをクリック
2. データが表示されるか確認

### テスト3: メモのエクスポート
1. 「📝 メモ」タブでメモを作成
2. 「📤」ボタンでエクスポート
3. Google Sheetsに「メモ」シートが作成され、データが追加されているか確認

---

## 🔧 トラブルシューティング

### エラー: "Script function not found"
**原因**: GASコードが正しく保存されていない
**解決**: Apps Scriptエディタでコードを確認し、再度保存

### エラー: "Authorization required"
**原因**: 承認が完了していない
**解決**: デプロイ時の承認手順を再度実行

### エラー: "CORS error"
**原因**: ブラウザのセキュリティ制限
**解決**: これは正常です。GASは正しく動作しています

### データが表示されない
**原因**: Web App URLが間違っている
**解決**: 
1. Apps Scriptで「デプロイ」→「デプロイを管理」
2. 最新のデプロイのURLを確認
3. ダッシュボードに再設定

---

## 📝 注意事項

- Web App URLは**秘密**にしてください（他人に教えない）
- スクリプトを更新した場合は、**新しいデプロイ**を作成してください
- Google Sheetsを削除すると、GASも削除されます

---

## 🎉 完了！

これでGoogle Sheetsとの連携が完了しました。
ダッシュボードからデータの読み書きができるようになります。
